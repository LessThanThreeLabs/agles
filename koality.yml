--- #Koality: 0.1.4
languages:
  python: 2.7
  ruby: 1.9.3
  nodejs: 0.8.12
setup:
  - packages:
    - system:
      - zlib1g
      - gcc
      - g++
      - curl
      - libssl-dev
      - apache2-utils
      - libevent-dev
      - libpq-dev
      - lessc
      - fontconfig  # for phantomjs
    - pip:
      - install requirements: ci/platform/requirements.txt
    - npm:
      - iced-coffee-script
      - less
      - karma
      - npm install: ci/web/back
  - databases:
    - postgres:
      - name: koality
        username: lt3
    - mysql:
      - name: koality
        username: lt3
  - scripts:
    - git config --global user.email "koality@koalitycode.com"
    - git config --global user.name "Koality"
    - directory: ci/scripts
      script: ./install_phantomjs.sh
    - directory: ci/scripts
      script: ./rabbitmq_setup.sh
compile:
  - python setup.py install:
      path: ci/platform
  - compile webserver:
      path: ci/web/back
      script: ./compile.sh
  - compile website:
      path: ci/web/front
      script: ./compile.sh
test:
  - platform unit tests:
      path: ci/platform
      script:
        - nosetests -sv tests/unit_tests
      timeout: 240
  - website unit tests:
      script:
        - karma start ci/web/front/test/karma.unit.conf.js --browsers PhantomJS --single-run
partition:
  - integration test partitioner:
      path: ci/platform
      script:
        - ls tests/integration_tests/*.py | while read test; do echo - nosetests -sv $test; done
