import glob
import os
#from setuptools import find_packages
from distutils.core import setup
from distutils.extension import Extension
from Cython.Distutils import build_ext


py_files = glob.glob('**/*.py')


#def get_extension(package_name):
#	file_names = [os.path.join(package_name, file) for file in os.listdir(package_name)]
#	file_names = filter(lambda file: file.endswith('.py'), file_names)
#	return Extension(package_name, file_names)


def get_extension(file_name):
	return Extension('koality.' + file_name[:-3].replace(os.path.sep, "."), [file_name])


#packages = find_packages(exclude=["bin", "tests"])
def get_packages(root_dir, parent):
	print root_dir, parent
	for dir in os.listdir(root_dir):
		if os.path.isdir(os.path.join(root_dir, dir)):
			if os.access(os.path.join(root_dir, dir, '__init__.py'), os.F_OK):
				packages.append(parent + dir)
				get_packages(os.path.join(root_dir, dir), parent + dir + '.')

packages = []
get_packages('.', '')
#packages = [dir for dir in os.listdir('.') if os.path.isdir(dir)]
#extensions = [get_extension(package) for package in packages]
extensions = [get_extension(py_file) for py_file in py_files]


setup(
	name="koality",
	version="0.1",
	description="Production code for koality",
	packages=packages,
	ext_modules=extensions,
	cmdclass = {'build_ext': build_ext},
	entry_points = {
		'console_scripts': [
			'koality-get-private-key = repo.scripts.get_private_key:main',
		],
	},
)
