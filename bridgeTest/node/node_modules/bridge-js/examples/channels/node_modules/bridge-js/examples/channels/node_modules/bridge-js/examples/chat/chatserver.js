var express = require('express');

var app =  express.createServer();

app.configure(function() {
  app.use(express.static(__dirname + '/public/'));
});

app.listen(4000);

var Bridge = require('bridge');
var bridge = new Bridge({apiKey:'abcdefgh', host:"cloud2.getbridge.com", port:8090, log:5});
  
var authHandler = {
  join: function(room, password, obj, callback) {
    if (password == "secret123") {
      console.log('Welcome!');
      // new: join channel using the client's objects
      bridge.joinChannel(room, obj, callback) 
    } else {
      console.log('Sorry!');
    }
  }
}

bridge.publishService('auth', authHandler);

bridge.connect();
